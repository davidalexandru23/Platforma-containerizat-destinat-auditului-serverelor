{
    "$schema": "bittrail-template@1.0",
    "metadata": {
        "name": "MITRE ATT&CK - Linux Server Defensive Coverage (Telemetry + Detections)",
        "description": "Template orientat pe acoperire defensiva MITRE ATT&CK pentru servere Linux. Include controale automatizabile prin agent (read-only) pentru a valida logging, auditd, procese, retea, integritate, si integrare cu SIEM/agent EDR.",
        "version": "1.1.0",
        "type": "MITRE",
        "author": "BitTrail Platform",
        "createdAt": "2026-01-27T00:00:00Z"
    },
    "controls": [
        {
            "controlId": "TA0001-T1078",
            "title": "Valid Accounts: monitorizare logins si conturi privilegiate",
            "category": "Initial Access / Credential Abuse",
            "description": "Tactic: TA0001, Technique: T1078 (Valid Accounts). Exista vizibilitate pe autentificari reusite/esuate si pe folosirea conturilor privilegiate (sudo/su).",
            "severity": "CRITICAL",
            "automatedChecks": [
                {
                    "checkId": "TA0001-T1078.a",
                    "title": "Auth events logging",
                    "command": "AUTH_EVENTS=$(journalctl --no-pager -n 500 2>/dev/null | grep -ciE 'sshd|login|pam_unix|authentication|Failed password|Accepted'); echo \"AUTH_EVENTS_FOUND=$AUTH_EVENTS\"; if [ \"$AUTH_EVENTS\" -gt 0 ]; then echo 'AUTH_LOGGING=ACTIVE'; echo 'CHECK=PASS'; else echo 'AUTH_LOGGING=NONE'; echo 'CHECK=FAIL'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "TA0001-T1078.b",
                    "title": "Sudo logging active",
                    "command": "SUDO_EVENTS=$(journalctl --no-pager -n 500 2>/dev/null | grep -ci 'sudo'); echo \"SUDO_EVENTS=$SUDO_EVENTS\"; if [ \"$SUDO_EVENTS\" -gt 0 ]; then echo 'SUDO_LOGGING=ACTIVE'; echo 'CHECK=PASS'; else echo 'SUDO_LOGGING=NONE'; echo 'CHECK=WARN'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "TA0001-T1078.c",
                    "title": "Privileged groups size",
                    "command": "TOTAL=$(getent group sudo wheel 2>/dev/null | cut -d: -f4 | tr ',' '\\n' | sort -u | grep -c '.'); echo \"PRIVILEGED_USERS=$TOTAL\"; getent group sudo wheel 2>/dev/null; if [ \"$TOTAL\" -le 5 ]; then echo 'CHECK=PASS'; else echo 'CHECK=REVIEW'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": [
                {
                    "checkId": "TA0001-T1078.M1",
                    "title": "Verificare reguli SIEM",
                    "instructions": "Incarcati Reguli SIEM/EDR pentru: brute force, login din IP-uri noi, folosire sudo neobisnuita.",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": true
                    }
                }
            ]
        },
        {
            "controlId": "TA0001-T1190",
            "title": "Exploit Public-Facing Application: inventar servicii expuse + loguri web",
            "category": "Initial Access",
            "description": "Tactic: TA0001, Technique: T1190 (Exploit Public-Facing Application). Serviciile expuse sunt inventariate, iar logurile aplicatiilor public-facing sunt colectate (nginx/apache/app logs).",
            "severity": "CRITICAL",
            "automatedChecks": [
                {
                    "checkId": "TA0001-T1190.a",
                    "title": "Listening ports inventory",
                    "command": "LISTEN_COUNT=$(ss -lntup 2>/dev/null | grep -c LISTEN); echo \"LISTENING_PORTS=$LISTEN_COUNT\"; ss -lntup 2>/dev/null | head -n 30; if [ \"$LISTEN_COUNT\" -le 20 ]; then echo 'CHECK=PASS'; else echo 'CHECK=REVIEW'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "TA0001-T1190.b",
                    "title": "Web server access logs",
                    "command": "HAS_LOGS='NO'; for f in /var/log/nginx/access.log /var/log/apache2/access.log /var/log/httpd/access_log; do if [ -f \"$f\" ]; then HAS_LOGS='YES'; SIZE=$(stat -c '%s' \"$f\" 2>/dev/null); echo \"WEBLOG=$f SIZE=$SIZE\"; fi; done; echo \"WEB_LOGS=$HAS_LOGS\"; if [ \"$HAS_LOGS\" = 'YES' ]; then echo 'CHECK=PASS'; else if ! command -v nginx >/dev/null 2>&1 && ! command -v apache2ctl >/dev/null 2>&1; then echo 'NO_WEB_SERVER'; echo 'CHECK=PASS'; else echo 'CHECK=FAIL'; fi; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": [
                {
                    "checkId": "TA0001-T1190.M1",
                    "title": "Verificare detectie web exploits",
                    "instructions": "Incarcati Reguli detectie: spike 4xx/5xx, path traversal, webshell patterns, user-agent suspect.",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": true
                    }
                }
            ]
        },
        {
            "controlId": "TA0001-T1110",
            "title": "Brute Force: limitare incercari + vizibilitate atac",
            "category": "Initial Access",
            "description": "Tactic: TA0001, Technique: T1110 (Brute Force). Exista protectie (faillock/fail2ban) si loguri pentru incercari repetate.",
            "severity": "HIGH",
            "automatedChecks": [
                {
                    "checkId": "TA0001-T1110.a",
                    "title": "Brute force protection",
                    "command": "PROTECTION='NONE'; if command -v fail2ban-client >/dev/null 2>&1; then PROTECTION='fail2ban'; fail2ban-client status 2>/dev/null | head -n 5; elif [ -f /etc/security/faillock.conf ]; then PROTECTION='faillock'; grep -v '^#' /etc/security/faillock.conf 2>/dev/null | grep -v '^$'; elif grep -q 'pam_faillock\\|pam_tally2' /etc/pam.d/* 2>/dev/null; then PROTECTION='pam_module'; fi; echo \"BRUTE_FORCE_PROTECTION=$PROTECTION\"; if [ \"$PROTECTION\" != 'NONE' ]; then echo 'CHECK=PASS'; else echo 'CHECK=FAIL'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "TA0001-T1110.b",
                    "title": "Failed password recent count",
                    "command": "FAILURES=$(journalctl --no-pager -n 1000 2>/dev/null | grep -ci 'Failed password'); echo \"RECENT_FAILED_PASSWORDS=$FAILURES\"; if [ \"$FAILURES\" -le 100 ]; then echo 'CHECK=PASS'; else echo 'CHECK=WARN'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "TA0003-T1053",
            "title": "Scheduled Task/Job: detectie persistenta prin cron/systemd timers",
            "category": "Persistence",
            "description": "Tactic: TA0003, Technique: T1053 (Scheduled Task/Job). Ai vizibilitate pe cronuri si systemd timers, inclusiv modificari.",
            "severity": "HIGH",
            "automatedChecks": [
                {
                    "checkId": "TA0003-T1053.a",
                    "title": "Cron jobs inventory",
                    "command": "CRON_FILES=0; for d in /etc/cron.d /etc/cron.daily /etc/cron.weekly /etc/cron.hourly /etc/cron.monthly; do [ -d \"$d\" ] && CRON_FILES=$((CRON_FILES + $(ls -1 \"$d\" 2>/dev/null | wc -l))); done; echo \"CRON_FILES=$CRON_FILES\"; ls -la /var/spool/cron/crontabs 2>/dev/null | head -n 10; echo 'CHECK=PASS'",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "TA0003-T1053.b",
                    "title": "Systemd timers inventory",
                    "command": "if command -v systemctl >/dev/null 2>&1; then TIMERS=$(systemctl list-timers --all --no-pager 2>/dev/null | grep -c 'timer'); echo \"SYSTEMD_TIMERS=$TIMERS\"; systemctl list-timers --all --no-pager 2>/dev/null | head -n 20; echo 'CHECK=PASS'; else echo 'SYSTEMCTL=NOT_AVAILABLE'; echo 'CHECK=WARN'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": [
                {
                    "checkId": "TA0003-T1053.M1",
                    "title": "Verificare detectie cron",
                    "instructions": "Incarcati Regula detectie: aparitie cron nou in afara change window.",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": true
                    }
                }
            ]
        },
        {
            "controlId": "TA0003-T1543",
            "title": "Create or Modify System Process: servicii systemd noi/modificate",
            "category": "Persistence",
            "description": "Tactic: TA0003, Technique: T1543 (Create or Modify System Process). Ai vizibilitate pe unit files (systemd) si servicii enable/start neobisnuit.",
            "severity": "CRITICAL",
            "automatedChecks": [
                {
                    "checkId": "TA0003-T1543.a",
                    "title": "Custom systemd units",
                    "command": "CUSTOM_UNITS=$(find /etc/systemd/system -maxdepth 2 -type f \\( -name '*.service' -o -name '*.timer' \\) 2>/dev/null | wc -l); echo \"CUSTOM_SYSTEMD_UNITS=$CUSTOM_UNITS\"; find /etc/systemd/system -maxdepth 2 -type f \\( -name '*.service' -o -name '*.timer' \\) 2>/dev/null | head -n 30; if [ \"$CUSTOM_UNITS\" -le 30 ]; then echo 'CHECK=PASS'; else echo 'CHECK=REVIEW'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "TA0003-T1543.b",
                    "title": "Enabled services count",
                    "command": "if command -v systemctl >/dev/null 2>&1; then ENABLED=$(systemctl list-unit-files --type=service --state=enabled --no-pager 2>/dev/null | grep -c 'enabled'); echo \"ENABLED_SERVICES=$ENABLED\"; if [ \"$ENABLED\" -le 40 ]; then echo 'CHECK=PASS'; else echo 'CHECK=REVIEW'; fi; else echo 'SYSTEMCTL=NOT_AVAILABLE'; echo 'CHECK=WARN'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "TA0004-T1548",
            "title": "Abuse Elevation Control Mechanism: sudo/suid/sgid vizibilitate",
            "category": "Privilege Escalation",
            "description": "Tactic: TA0004, Technique: T1548 (Abuse Elevation Control Mechanism). Exista vizibilitate pe sudo rules si pe fisiere SUID/SGID care pot fi abuzate.",
            "severity": "CRITICAL",
            "automatedChecks": [
                {
                    "checkId": "TA0004-T1548.a",
                    "title": "NOPASSWD in sudoers",
                    "command": "NOPASSWD=$(grep -rn 'NOPASSWD' /etc/sudoers /etc/sudoers.d 2>/dev/null | grep -cv '^#'); echo \"NOPASSWD_ENTRIES=$NOPASSWD\"; if [ \"$NOPASSWD\" -eq 0 ]; then echo 'CHECK=PASS'; else echo 'CHECK=WARN'; grep -rn 'NOPASSWD' /etc/sudoers /etc/sudoers.d 2>/dev/null | grep -v '^#'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "TA0004-T1548.b",
                    "title": "SUID/SGID files count",
                    "command": "COUNT=$(find / -xdev \\( -perm -4000 -o -perm -2000 \\) -type f 2>/dev/null | wc -l); echo \"SUID_SGID_FILES=$COUNT\"; if [ \"$COUNT\" -le 30 ]; then echo 'CHECK=PASS'; else echo 'CHECK=REVIEW'; find / -xdev \\( -perm -4000 -o -perm -2000 \\) -type f 2>/dev/null | head -n 30; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": [
                {
                    "checkId": "TA0004-T1548.M1",
                    "title": "Verificare SUID review",
                    "instructions": "Incarcati Proces de review pentru SUID/SGID + exceptii aprobate.",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": true
                    }
                }
            ]
        },
        {
            "controlId": "TA0005-T1562",
            "title": "Impair Defenses: detectie oprire logging/EDR/auditd",
            "category": "Defense Evasion",
            "description": "Tactic: TA0005, Technique: T1562 (Impair Defenses). Se detecteaza oprirea journald/rsyslog/auditd/agent EDR si modificarile de config.",
            "severity": "CRITICAL",
            "automatedChecks": [
                {
                    "checkId": "TA0005-T1562.a",
                    "title": "Logging services active",
                    "command": "SCORE=0; systemctl is-active systemd-journald >/dev/null 2>&1 && SCORE=$((SCORE+1)) && echo 'JOURNALD=ACTIVE'; systemctl is-active rsyslog >/dev/null 2>&1 && SCORE=$((SCORE+1)) && echo 'RSYSLOG=ACTIVE'; systemctl is-active auditd >/dev/null 2>&1 && SCORE=$((SCORE+1)) && echo 'AUDITD=ACTIVE'; echo \"LOGGING_SERVICES_ACTIVE=$SCORE/3\"; if [ \"$SCORE\" -ge 2 ]; then echo 'CHECK=PASS'; else echo 'CHECK=FAIL'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "TA0005-T1562.b",
                    "title": "Auditd rules count",
                    "command": "RULES=$(auditctl -l 2>/dev/null | wc -l); echo \"AUDIT_RULES=$RULES\"; if [ \"$RULES\" -gt 0 ]; then echo 'CHECK=PASS'; auditctl -l 2>/dev/null | head -n 20; else echo 'CHECK=WARN'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "TA0005-T1562.c",
                    "title": "EDR/security agents running",
                    "command": "AGENTS=''; for p in osqueryd elastic-agent falcon-sensor wazuh-agentd; do pgrep -x \"$p\" >/dev/null 2>&1 && AGENTS=\"$AGENTS $p\"; done; if [ -n \"$AGENTS\" ]; then echo \"SECURITY_AGENTS=$AGENTS\"; echo 'CHECK=PASS'; else echo 'SECURITY_AGENTS=NONE'; echo 'CHECK=INFO'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": [
                {
                    "checkId": "TA0005-T1562.M1",
                    "title": "Verificare alertare defense evasion",
                    "instructions": "Incarcati Regula alertare: stop/disable auditd/rsyslog/EDR.",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": true
                    }
                }
            ]
        },
        {
            "controlId": "TA0005-T1070",
            "title": "Indicator Removal on Host: stergere loguri si urme",
            "category": "Defense Evasion",
            "description": "Tactic: TA0005, Technique: T1070 (Indicator Removal on Host). Exista vizibilitate pe logrotate/retentie, plus detectie la stergere masiva loguri.",
            "severity": "HIGH",
            "automatedChecks": [
                {
                    "checkId": "TA0005-T1070.a",
                    "title": "Logrotate configured",
                    "command": "if [ -f /etc/logrotate.conf ]; then echo 'LOGROTATE=CONFIGURED'; echo 'CHECK=PASS'; else echo 'LOGROTATE=MISSING'; echo 'CHECK=FAIL'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "TA0005-T1070.b",
                    "title": "Log files freshness",
                    "command": "RECENT=$(find /var/log -maxdepth 2 -type f -mmin -60 2>/dev/null | wc -l); TOTAL=$(find /var/log -maxdepth 2 -type f 2>/dev/null | wc -l); echo \"LOG_FILES_TOTAL=$TOTAL\"; echo \"LOG_FILES_RECENT_1H=$RECENT\"; if [ \"$RECENT\" -gt 0 ]; then echo 'CHECK=PASS'; else echo 'CHECK=WARN'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": [
                {
                    "checkId": "TA0005-T1070.M1",
                    "title": "Verificare log gaps",
                    "instructions": "Incarcati Regula alertare: scadere brusca volum loguri / log gaps.",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": true
                    }
                }
            ]
        },
        {
            "controlId": "TA0006-T1003",
            "title": "OS Credential Dumping: protectie /etc/shadow si detectie acces",
            "category": "Credential Access",
            "description": "Tactic: TA0006, Technique: T1003 (OS Credential Dumping). Fisierele de credentiale sunt protejate, iar accesul poate fi auditat (auditd).",
            "severity": "CRITICAL",
            "automatedChecks": [
                {
                    "checkId": "TA0006-T1003.a",
                    "title": "Shadow file permissions",
                    "command": "SCORE=0; for f in /etc/shadow /etc/gshadow; do if [ -f \"$f\" ]; then PERM=$(stat -c '%a' \"$f\" 2>/dev/null); OWNER=$(stat -c '%U' \"$f\" 2>/dev/null); echo \"$f owner=$OWNER perm=$PERM\"; if [ \"$OWNER\" = 'root' ] && [ \"$PERM\" = '640' ] || [ \"$PERM\" = '600' ] || [ \"$PERM\" = '000' ]; then SCORE=$((SCORE+1)); fi; fi; done; echo \"SHADOW_PROTECTED=$SCORE\"; if [ \"$SCORE\" -ge 1 ]; then echo 'CHECK=PASS'; else echo 'CHECK=FAIL'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "TA0006-T1003.b",
                    "title": "Audit rules for shadow files",
                    "command": "RULES=$(grep -rcE '/etc/shadow|/etc/gshadow' /etc/audit/rules.d 2>/dev/null | grep -cv ':0$'); echo \"SHADOW_AUDIT_RULES=$RULES\"; if [ \"$RULES\" -gt 0 ]; then grep -rE '/etc/shadow|/etc/gshadow' /etc/audit/rules.d 2>/dev/null; echo 'CHECK=PASS'; else echo 'CHECK=WARN'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": [
                {
                    "checkId": "TA0006-T1003.M1",
                    "title": "Verificare detectie acces shadow",
                    "instructions": "Incarcati Regula auditd/EDR: citire /etc/shadow de procese neobisnuite.",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": true
                    }
                }
            ]
        },
        {
            "controlId": "TA0007-T1082",
            "title": "System Information Discovery: comenzi de discovery",
            "category": "Discovery",
            "description": "Tactic: TA0007, Technique: T1082 (System Information Discovery). Ai telemetrie (auditd/EDR) pentru comenzi de discovery folosite in atacuri, ca semnal de chain.",
            "severity": "MEDIUM",
            "automatedChecks": [
                {
                    "checkId": "TA0007-T1082.a",
                    "title": "Audit execve rules",
                    "command": "EXECVE_RULES=$(auditctl -l 2>/dev/null | grep -ci execve); echo \"EXECVE_AUDIT_RULES=$EXECVE_RULES\"; if [ \"$EXECVE_RULES\" -gt 0 ]; then echo 'CHECK=PASS'; auditctl -l 2>/dev/null | grep -i execve | head -n 10; else echo 'CHECK=WARN'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "TA0007-T1082.b",
                    "title": "Shell history retention",
                    "command": "HIST_FILES=0; for f in /root/.bash_history /home/*/.bash_history; do [ -f \"$f\" ] && HIST_FILES=$((HIST_FILES+1)); done 2>/dev/null; echo \"BASH_HISTORY_FILES=$HIST_FILES\"; if [ \"$HIST_FILES\" -gt 0 ]; then echo 'CHECK=PASS'; else echo 'CHECK=WARN'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "TA0007-T1046",
            "title": "Network Service Discovery: scanare si servicii interne",
            "category": "Discovery",
            "description": "Tactic: TA0007, Technique: T1046 (Network Service Discovery). Ai vizibilitate pe conexiuni si tool-uri de scan (nmap, masscan) plus trafic suspect.",
            "severity": "HIGH",
            "automatedChecks": [
                {
                    "checkId": "TA0007-T1046.a",
                    "title": "Scan tools installed",
                    "command": "TOOLS=''; command -v nmap >/dev/null 2>&1 && TOOLS=\"$TOOLS nmap\"; command -v masscan >/dev/null 2>&1 && TOOLS=\"$TOOLS masscan\"; command -v nc >/dev/null 2>&1 && TOOLS=\"$TOOLS nc\"; command -v ncat >/dev/null 2>&1 && TOOLS=\"$TOOLS ncat\"; if [ -n \"$TOOLS\" ]; then echo \"SCAN_TOOLS=$TOOLS\"; echo 'CHECK=REVIEW'; else echo 'SCAN_TOOLS=NONE'; echo 'CHECK=PASS'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "TA0007-T1046.b",
                    "title": "Established connections count",
                    "command": "ESTAB=$(ss -antup 2>/dev/null | grep -c ESTAB); echo \"ESTABLISHED_CONNECTIONS=$ESTAB\"; if [ \"$ESTAB\" -le 100 ]; then echo 'CHECK=PASS'; else echo 'CHECK=REVIEW'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "TA0008-T1021",
            "title": "Remote Services: SSH lateral movement + restrictii",
            "category": "Lateral Movement",
            "description": "Tactic: TA0008, Technique: T1021 (Remote Services). SSH este harden-uit (fara root login, allowlist), iar logurile sunt colectate pentru lateral movement.",
            "severity": "HIGH",
            "automatedChecks": [
                {
                    "checkId": "TA0008-T1021.a",
                    "title": "SSH hardening score",
                    "command": "SCORE=0; TOTAL=3; VALUE=$(sshd -T 2>/dev/null | grep -i 'permitrootlogin' | awk '{print $2}'); echo \"PermitRootLogin=$VALUE\"; echo \"$VALUE\" | grep -qiE '^(no|prohibit-password)$' && SCORE=$((SCORE+1)); VALUE=$(sshd -T 2>/dev/null | grep -i 'passwordauthentication' | awk '{print $2}'); echo \"PasswordAuthentication=$VALUE\"; echo \"$VALUE\" | grep -qi 'no' && SCORE=$((SCORE+1)); VALUE=$(sshd -T 2>/dev/null | grep -i 'pubkeyauthentication' | awk '{print $2}'); echo \"PubkeyAuthentication=$VALUE\"; echo \"$VALUE\" | grep -qi 'yes' && SCORE=$((SCORE+1)); echo \"SSH_HARDENING_SCORE=$SCORE/$TOTAL\"; if [ \"$SCORE\" -ge 2 ]; then echo 'CHECK=PASS'; else echo 'CHECK=FAIL'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": [
                {
                    "checkId": "TA0008-T1021.M1",
                    "title": "Verificare lateral movement",
                    "instructions": "Incarcati Regula alertare: ssh login din host intern neasteptat / pivot.",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": true
                    }
                }
            ]
        },
        {
            "controlId": "TA0011-T1105",
            "title": "Ingress Tool Transfer: download tool-uri (curl/wget) si detectie",
            "category": "Command and Control",
            "description": "Tactic: TA0011, Technique: T1105 (Ingress Tool Transfer). Se detecteaza descarcari de executabile/scripturi prin curl/wget si output suspicious.",
            "severity": "HIGH",
            "automatedChecks": [
                {
                    "checkId": "TA0011-T1105.a",
                    "title": "Download tools present",
                    "command": "TOOLS=''; command -v curl >/dev/null 2>&1 && TOOLS=\"$TOOLS curl\"; command -v wget >/dev/null 2>&1 && TOOLS=\"$TOOLS wget\"; echo \"DOWNLOAD_TOOLS=$TOOLS\"; echo 'CHECK=PASS'",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "TA0011-T1105.b",
                    "title": "Suspicious files in tmp",
                    "command": "SUSPICIOUS=0; for d in /tmp /var/tmp /dev/shm; do if [ -d \"$d\" ]; then COUNT=$(find \"$d\" -maxdepth 2 -type f \\( -perm -100 -o -name '*.sh' -o -name '*.py' -o -name '*.pl' \\) 2>/dev/null | wc -l); SUSPICIOUS=$((SUSPICIOUS+COUNT)); fi; done; echo \"SUSPICIOUS_TMP_FILES=$SUSPICIOUS\"; if [ \"$SUSPICIOUS\" -le 5 ]; then echo 'CHECK=PASS'; else echo 'CHECK=REVIEW'; for d in /tmp /var/tmp /dev/shm; do find \"$d\" -maxdepth 2 -type f \\( -perm -100 -o -name '*.sh' \\) 2>/dev/null | head -n 10; done; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": [
                {
                    "checkId": "TA0011-T1105.M1",
                    "title": "Verificare executie din tmp",
                    "instructions": "Incarcati Regula detectie: executabil nou in /tmp, /dev/shm + rulare imediata.",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": true
                    }
                }
            ]
        },
        {
            "controlId": "TA0011-T1071",
            "title": "Application Layer Protocol: C2 peste HTTP(S)/DNS si telemetrie",
            "category": "Command and Control",
            "description": "Tactic: TA0011, Technique: T1071 (Application Layer Protocol). Ai vizibilitate pe conexiuni outbound si (ideal) DNS logs pentru detectii C2 basic.",
            "severity": "HIGH",
            "automatedChecks": [
                {
                    "checkId": "TA0011-T1071.a",
                    "title": "DNS resolver config",
                    "command": "if [ -f /etc/resolv.conf ]; then echo 'RESOLVER=CONFIGURED'; cat /etc/resolv.conf 2>/dev/null | grep nameserver; echo 'CHECK=PASS'; else echo 'RESOLVER=MISSING'; echo 'CHECK=FAIL'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "TA0011-T1071.b",
                    "title": "Outbound connections",
                    "command": "OUTBOUND=$(ss -antup 2>/dev/null | grep ESTAB | wc -l); echo \"OUTBOUND_CONNECTIONS=$OUTBOUND\"; ss -antup 2>/dev/null | grep ESTAB | head -n 20; if [ \"$OUTBOUND\" -le 50 ]; then echo 'CHECK=PASS'; else echo 'CHECK=REVIEW'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": [
                {
                    "checkId": "TA0011-T1071.M1",
                    "title": "Verificare DNS logging",
                    "instructions": "Incarcati Dovada DNS logging (resolver central / SIEM) daca e cerut.",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": true
                    }
                }
            ]
        },
        {
            "controlId": "TA0010-T1041",
            "title": "Exfiltration Over C2 Channel: detectie upload neobisnuit",
            "category": "Exfiltration",
            "description": "Tactic: TA0010, Technique: T1041 (Exfiltration Over C2 Channel). Ai semnale minime: conexiuni persistente, volum de date, procese care initiaza transfer.",
            "severity": "HIGH",
            "automatedChecks": [
                {
                    "checkId": "TA0010-T1041.a",
                    "title": "Network processes visibility",
                    "command": "if command -v lsof >/dev/null 2>&1; then NET_PROCS=$(lsof -i -n -P 2>/dev/null | grep -c ESTABLISHED); echo \"NET_PROCESSES=$NET_PROCS\"; echo 'LSOF=AVAILABLE'; echo 'CHECK=PASS'; else echo 'LSOF=NOT_AVAILABLE'; NET_PROCS=$(ss -antup 2>/dev/null | grep -c ESTAB); echo \"NET_PROCESSES=$NET_PROCS\"; echo 'CHECK=PASS'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": [
                {
                    "checkId": "TA0010-T1041.M1",
                    "title": "Verificare volum trafic",
                    "instructions": "Incarcati Integrare NDR/Firewall logs pentru volum si destinatii.",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": true
                    }
                }
            ]
        },
        {
            "controlId": "TA0040-T1486",
            "title": "Data Encrypted for Impact: semnale ransomware",
            "category": "Impact",
            "description": "Tactic: TA0040, Technique: T1486 (Data Encrypted for Impact). Ai verificari preventive (backup) si semnale de detectie (procese ciudate, spike disk).",
            "severity": "CRITICAL",
            "automatedChecks": [
                {
                    "checkId": "TA0040-T1486.a",
                    "title": "Backup presence",
                    "command": "BACKUP_FOUND=$(grep -rlE 'restic|borg|rclone|rsync|backup' /etc/cron.* /etc/crontab 2>/dev/null | wc -l); echo \"BACKUP_CRON_REFS=$BACKUP_FOUND\"; TOOLS=''; command -v restic >/dev/null 2>&1 && TOOLS=\"$TOOLS restic\"; command -v borg >/dev/null 2>&1 && TOOLS=\"$TOOLS borg\"; command -v rsync >/dev/null 2>&1 && TOOLS=\"$TOOLS rsync\"; echo \"BACKUP_TOOLS=$TOOLS\"; if [ \"$BACKUP_FOUND\" -gt 0 ] || [ -n \"$TOOLS\" ]; then echo 'CHECK=PASS'; else echo 'CHECK=FAIL'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "TA0040-T1486.b",
                    "title": "Disk usage normal",
                    "command": "HIGH_USAGE=$(df -h 2>/dev/null | awk 'NR>1 {gsub(/%/,\"\",$5); if($5+0 > 90) print $0}' | wc -l); echo \"HIGH_DISK_PARTITIONS=$HIGH_USAGE\"; df -h 2>/dev/null | head -n 10; if [ \"$HIGH_USAGE\" -eq 0 ]; then echo 'CHECK=PASS'; else echo 'CHECK=WARN'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": [
                {
                    "checkId": "TA0040-T1486.M1",
                    "title": "Verificare restore",
                    "instructions": "Incarcati Dovada restore test (data + rezultat).",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": true
                    }
                }
            ]
        },
        {
            "controlId": "COVERAGE-LOG-01",
            "title": "Logging Core: journald/rsyslog activ + retentie minim 30 zile",
            "category": "Telemetry Baseline",
            "description": "Fara loguri consistente, ATT&CK coverage e fake. Verificam ca pipeline-ul de logging e activ si are retentie minima.",
            "severity": "CRITICAL",
            "automatedChecks": [
                {
                    "checkId": "COVERAGE-LOG-01.a",
                    "title": "Journald active and usage",
                    "command": "if systemctl is-active systemd-journald >/dev/null 2>&1; then echo 'JOURNALD=ACTIVE'; journalctl --disk-usage 2>/dev/null; echo 'CHECK=PASS'; else echo 'JOURNALD=INACTIVE'; echo 'CHECK=FAIL'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "COVERAGE-LOG-01.b",
                    "title": "Rsyslog active",
                    "command": "if systemctl is-active rsyslog >/dev/null 2>&1; then echo 'RSYSLOG=ACTIVE'; echo 'CHECK=PASS'; else echo 'RSYSLOG=INACTIVE'; echo 'CHECK=WARN'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "COVERAGE-LOG-02",
            "title": "Process Creation: auditd/EDR pentru executii (execve)",
            "category": "Telemetry Baseline",
            "description": "Ai nevoie de proces creation pentru detectii reale (curl/wget/nc/bash -c, etc.).",
            "severity": "CRITICAL",
            "automatedChecks": [
                {
                    "checkId": "COVERAGE-LOG-02.a",
                    "title": "Auditd active",
                    "command": "if systemctl is-active auditd >/dev/null 2>&1; then echo 'AUDITD=ACTIVE'; auditctl -s 2>/dev/null | head -n 5; echo 'CHECK=PASS'; else echo 'AUDITD=INACTIVE'; echo 'CHECK=FAIL'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "COVERAGE-LOG-02.b",
                    "title": "Audit rules defined",
                    "command": "RULES=$(auditctl -l 2>/dev/null | wc -l); echo \"AUDIT_RULES=$RULES\"; if [ \"$RULES\" -gt 0 ]; then auditctl -l 2>/dev/null | head -n 20; echo 'CHECK=PASS'; else echo 'CHECK=FAIL'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": [
                {
                    "checkId": "COVERAGE-LOG-02.M1",
                    "title": "Verificare SIEM integration",
                    "instructions": "Incarcati Mapping: ce evenimente ajung in SIEM (process start, user, tty, cwd, hash daca exista).",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": true
                    }
                }
            ]
        },
        {
            "controlId": "COVERAGE-NET-01",
            "title": "Network Telemetry: conexiuni inbound/outbound si porturi ascultate",
            "category": "Telemetry Baseline",
            "description": "Minim: ce asculta, cine se conecteaza, conexiuni persistente.",
            "severity": "HIGH",
            "automatedChecks": [
                {
                    "checkId": "COVERAGE-NET-01.a",
                    "title": "Listening ports",
                    "command": "LISTEN=$(ss -lntup 2>/dev/null | grep -c LISTEN); echo \"LISTENING_PORTS=$LISTEN\"; ss -lntup 2>/dev/null | head -n 20; echo 'CHECK=PASS'",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "COVERAGE-NET-01.b",
                    "title": "Established connections",
                    "command": "ESTAB=$(ss -antup 2>/dev/null | grep -c ESTAB); echo \"ESTABLISHED=$ESTAB\"; ss -antup 2>/dev/null | grep ESTAB | head -n 20; echo 'CHECK=PASS'",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "COVERAGE-INTEGRITY-01",
            "title": "File Integrity: detectie modificari in fisiere critice",
            "category": "Telemetry Baseline",
            "description": "Pentru persistence/defense evasion: ai nevoie de integritate pe fisiere critice (/etc/ssh, sudoers, systemd).",
            "severity": "HIGH",
            "automatedChecks": [
                {
                    "checkId": "COVERAGE-INTEGRITY-01.a",
                    "title": "Critical config hashes",
                    "command": "FOUND=0; for f in /etc/ssh/sshd_config /etc/sudoers /etc/passwd /etc/shadow /etc/crontab /etc/sysctl.conf; do if [ -f \"$f\" ]; then FOUND=$((FOUND+1)); echo \"$(sha256sum \"$f\")\"; fi; done; echo \"HASHED_FILES=$FOUND\"; if [ \"$FOUND\" -ge 3 ]; then echo 'CHECK=PASS'; else echo 'CHECK=FAIL'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": [
                {
                    "checkId": "COVERAGE-INTEGRITY-01.M1",
                    "title": "Verificare FIM",
                    "instructions": "Incarcati Dovada FIM (AIDE/Wazuh/Tripwire/osquery) daca e implementat.",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": true
                    }
                }
            ]
        },
        {
            "controlId": "COVERAGE-TIME-01",
            "title": "Time Sync: NTP activ pentru corelare evenimente",
            "category": "Telemetry Baseline",
            "description": "Fara timp corect, corelarea in SIEM e varza.",
            "severity": "MEDIUM",
            "automatedChecks": [
                {
                    "checkId": "COVERAGE-TIME-01.a",
                    "title": "NTP sync status",
                    "command": "if timedatectl status 2>/dev/null | grep -qi 'synchronized: yes\\|NTP.*active'; then echo 'NTP=SYNCED'; timedatectl status 2>/dev/null | head -n 5; echo 'CHECK=PASS'; elif systemctl is-active chronyd >/dev/null 2>&1; then echo 'NTP=SYNCED'; echo 'CHECK=PASS'; elif systemctl is-active systemd-timesyncd >/dev/null 2>&1; then echo 'NTP=SYNCED'; echo 'CHECK=PASS'; else echo 'NTP=NOT_SYNCED'; echo 'CHECK=FAIL'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "DETECT-01",
            "title": "Detections Pack: reguli minime recomandate",
            "category": "Detections",
            "description": "Set minim de reguli in SIEM/EDR pentru Linux care acopera cele mai comune chain-uri ATT&CK.",
            "severity": "HIGH",
            "automatedChecks": [],
            "manualChecks": [
                {
                    "checkId": "DETECT-01.M1",
                    "title": "Verificare reguli detectie",
                    "instructions": "Incarcati dovezi pentru: Brute force SSH, New cron, sudo neobisnuit, curl | bash, modificare sshd_config, outbound ciudat, stop auditd.",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": true
                    }
                }
            ]
        }
    ]
}