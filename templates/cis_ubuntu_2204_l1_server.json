{
    "$schema": "bittrail-template@1.0",
    "metadata": {
        "name": "CIS Ubuntu 22.04 LTS Level 1 Server",
        "description": "Template de audit inspirat de CIS Benchmark pentru Ubuntu 22.04 LTS Level 1 Server. Controale proprii verificabile pentru configuratii de securitate de baza.",
        "version": "1.0.0",
        "type": "CIS_BENCHMARK",
        "author": "BitTrail Platform",
        "createdAt": "2024-01-01T00:00:00Z"
    },
    "controls": [
        {
            "controlId": "1.1.1",
            "title": "Verifica dezactivare montare cramfs",
            "category": "Filesystem > Configurare Module",
            "severity": "MEDIUM",
            "rationale": "Dezactivarea sistemelor de fisiere nefolosite reduce suprafata de atac.",
            "automatedChecks": [
                {
                    "checkId": "1.1.1.1",
                    "title": "Verifica status modul cramfs",
                    "command": "modprobe -n -v cramfs 2>/dev/null | grep -E '(install|blacklist)'",
                    "expectedResult": "install /bin/true",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "1.1.1.2",
                    "title": "Verifica daca cramfs e incarcat",
                    "command": "lsmod | grep cramfs || echo 'NOT_LOADED'",
                    "expectedResult": "NOT_LOADED",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "1.1.2",
            "title": "Verifica dezactivare montare squashfs",
            "category": "Filesystem > Configurare Module",
            "severity": "MEDIUM",
            "rationale": "Sistemul squashfs este rar necesar pe servere si reduce suprafata de atac.",
            "automatedChecks": [
                {
                    "checkId": "1.1.2.1",
                    "title": "Verifica status modul squashfs",
                    "command": "modprobe -n -v squashfs 2>/dev/null | grep -E '(install|blacklist)'",
                    "expectedResult": "install /bin/true",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "1.1.3",
            "title": "Verifica dezactivare montare udf",
            "category": "Filesystem > Configurare Module",
            "severity": "LOW",
            "rationale": "UDF e folosit pentru CD/DVD si nu e necesar pe majoritatea serverelor.",
            "automatedChecks": [
                {
                    "checkId": "1.1.3.1",
                    "title": "Verifica status modul udf",
                    "command": "modprobe -n -v udf 2>/dev/null | grep -E '(install|blacklist)'",
                    "expectedResult": "install /bin/true",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "1.2.1",
            "title": "Verifica configurare apt sources",
            "category": "Software Updates > Repositories",
            "severity": "HIGH",
            "rationale": "Repository-urile trebuie sa fie oficiale Ubuntu pentru a primi update-uri de securitate.",
            "automatedChecks": [
                {
                    "checkId": "1.2.1.1",
                    "title": "Verifica surse apt",
                    "command": "grep -rE '^deb' /etc/apt/sources.list /etc/apt/sources.list.d/ 2>/dev/null | grep -v '#' | head -10",
                    "expectedResult": "ubuntu",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": [
                {
                    "checkId": "1.2.1.M1",
                    "title": "Revizuieste repository-uri third-party",
                    "instructions": "Verifica daca exista repository-uri third-party si valideaza ca sunt de incredere.",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": false,
                        "allowAttestation": true,
                        "requiresApproval": false
                    }
                }
            ]
        },
        {
            "controlId": "1.3.1",
            "title": "Verifica AIDE sau alt sistem de integritate instalat",
            "category": "Filesystem Integrity > AIDE",
            "severity": "HIGH",
            "rationale": "Un sistem de verificare integritate detecteaza modificari neautorizate ale fisierelor.",
            "automatedChecks": [
                {
                    "checkId": "1.3.1.1",
                    "title": "Verifica instalare AIDE",
                    "command": "dpkg -s aide 2>/dev/null | grep -i status || echo 'NOT_INSTALLED'",
                    "expectedResult": "install ok installed",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "1.4.1",
            "title": "Verifica parola bootloader",
            "category": "Boot Settings > GRUB",
            "severity": "HIGH",
            "rationale": "Protejarea bootloader-ului previne modificari boot malitioase.",
            "automatedChecks": [
                {
                    "checkId": "1.4.1.1",
                    "title": "Verifica existenta parola GRUB",
                    "command": "grep -E '^password' /boot/grub/grub.cfg 2>/dev/null || echo 'NO_PASSWORD'",
                    "expectedResult": "password",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "1.5.1",
            "title": "Verifica core dumps restrictionate",
            "category": "Process Hardening",
            "severity": "MEDIUM",
            "rationale": "Core dumps pot contine date sensibile si trebuie restrictionate.",
            "automatedChecks": [
                {
                    "checkId": "1.5.1.1",
                    "title": "Verifica limits.conf pentru core",
                    "command": "grep -E '^\\*.*hard.*core.*0' /etc/security/limits.conf /etc/security/limits.d/* 2>/dev/null || echo 'NOT_SET'",
                    "expectedResult": "hard core 0",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "1.5.1.2",
                    "title": "Verifica sysctl fs.suid_dumpable",
                    "command": "sysctl fs.suid_dumpable 2>/dev/null",
                    "expectedResult": "fs.suid_dumpable = 0",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "1.5.2",
            "title": "Verifica ASLR activat",
            "category": "Process Hardening",
            "severity": "HIGH",
            "rationale": "ASLR face exploatarea vulnerabilitatilor mai dificila.",
            "automatedChecks": [
                {
                    "checkId": "1.5.2.1",
                    "title": "Verifica sysctl randomize_va_space",
                    "command": "sysctl kernel.randomize_va_space 2>/dev/null",
                    "expectedResult": "kernel.randomize_va_space = 2",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "2.1.1",
            "title": "Verifica serviciul xinetd dezactivat",
            "category": "Services > Legacy Services",
            "severity": "HIGH",
            "rationale": "xinetd nu mai e necesar pe sisteme moderne si poate fi un vector de atac.",
            "automatedChecks": [
                {
                    "checkId": "2.1.1.1",
                    "title": "Verifica status xinetd",
                    "command": "systemctl is-enabled xinetd 2>/dev/null || echo 'NOT_INSTALLED'",
                    "expectedResult": "NOT_INSTALLED",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "2.2.1",
            "title": "Verifica time synchronization configurat",
            "category": "Services > Time Synchronization",
            "severity": "MEDIUM",
            "rationale": "Sincronizarea timpului e critica pentru logging si autentificare.",
            "automatedChecks": [
                {
                    "checkId": "2.2.1.1",
                    "title": "Verifica status chrony sau ntp",
                    "command": "systemctl is-active chrony 2>/dev/null || systemctl is-active ntp 2>/dev/null || systemctl is-active systemd-timesyncd 2>/dev/null || echo 'NOT_ACTIVE'",
                    "expectedResult": "active",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "3.1.1",
            "title": "Verifica IP forwarding dezactivat",
            "category": "Network > Network Parameters Host Only",
            "severity": "MEDIUM",
            "rationale": "Serverele care nu sunt routere nu ar trebui sa faca IP forwarding.",
            "automatedChecks": [
                {
                    "checkId": "3.1.1.1",
                    "title": "Verifica net.ipv4.ip_forward",
                    "command": "sysctl net.ipv4.ip_forward 2>/dev/null",
                    "expectedResult": "net.ipv4.ip_forward = 0",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "3.1.1.2",
                    "title": "Verifica net.ipv6.conf.all.forwarding",
                    "command": "sysctl net.ipv6.conf.all.forwarding 2>/dev/null",
                    "expectedResult": "net.ipv6.conf.all.forwarding = 0",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "3.2.1",
            "title": "Verifica source routing dezactivat",
            "category": "Network > Network Parameters Host and Router",
            "severity": "MEDIUM",
            "rationale": "Source routing poate fi folosit in atacuri de tip man-in-the-middle.",
            "automatedChecks": [
                {
                    "checkId": "3.2.1.1",
                    "title": "Verifica accept_source_route IPv4",
                    "command": "sysctl net.ipv4.conf.all.accept_source_route 2>/dev/null",
                    "expectedResult": "net.ipv4.conf.all.accept_source_route = 0",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "3.3.1",
            "title": "Verifica firewall instalat si activ",
            "category": "Network > Firewall",
            "severity": "CRITICAL",
            "rationale": "Firewall-ul este esential pentru protectia perimetrului.",
            "automatedChecks": [
                {
                    "checkId": "3.3.1.1",
                    "title": "Verifica status ufw",
                    "command": "ufw status 2>/dev/null | head -1",
                    "expectedResult": "Status: active",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": [
                {
                    "checkId": "3.3.1.M1",
                    "title": "Revizuieste regulile firewall",
                    "instructions": "Verifica ca regulile firewall sunt conform politicii de securitate. Export-eaza output-ul 'ufw status verbose'.",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": false,
                        "allowAttestation": true,
                        "requiresApproval": true
                    }
                }
            ]
        },
        {
            "controlId": "4.1.1",
            "title": "Verifica auditd instalat",
            "category": "Logging and Auditing > Configure System Accounting",
            "severity": "HIGH",
            "rationale": "Auditd permite auditarea detaliata a evenimentelor de securitate.",
            "automatedChecks": [
                {
                    "checkId": "4.1.1.1",
                    "title": "Verifica instalare auditd",
                    "command": "dpkg -s auditd 2>/dev/null | grep -i status || echo 'NOT_INSTALLED'",
                    "expectedResult": "install ok installed",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "4.1.1.2",
                    "title": "Verifica auditd activ",
                    "command": "systemctl is-active auditd 2>/dev/null || echo 'NOT_ACTIVE'",
                    "expectedResult": "active",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "4.2.1",
            "title": "Verifica rsyslog instalat",
            "category": "Logging and Auditing > Configure Logging",
            "severity": "HIGH",
            "rationale": "Logging centralizat e esential pentru detectarea incidentelor.",
            "automatedChecks": [
                {
                    "checkId": "4.2.1.1",
                    "title": "Verifica instalare rsyslog",
                    "command": "dpkg -s rsyslog 2>/dev/null | grep -i status || echo 'NOT_INSTALLED'",
                    "expectedResult": "install ok installed",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "5.1.1",
            "title": "Verifica permisiuni crontab",
            "category": "Access Control > Configure Cron",
            "severity": "MEDIUM",
            "rationale": "Permisiunile restrictive pe cron previn executia neautorizata de task-uri.",
            "automatedChecks": [
                {
                    "checkId": "5.1.1.1",
                    "title": "Verifica permisiuni /etc/crontab",
                    "command": "stat -c '%a %U %G' /etc/crontab 2>/dev/null",
                    "expectedResult": "600 root root",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "5.2.1",
            "title": "Verifica permisiuni sshd_config",
            "category": "Access Control > SSH Server",
            "severity": "HIGH",
            "rationale": "Configuratia SSH trebuie protejata impotriva modificarilor.",
            "automatedChecks": [
                {
                    "checkId": "5.2.1.1",
                    "title": "Verifica permisiuni /etc/ssh/sshd_config",
                    "command": "stat -c '%a %U %G' /etc/ssh/sshd_config 2>/dev/null",
                    "expectedResult": "600 root root",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "5.2.2",
            "title": "Verifica SSH Protocol 2",
            "category": "Access Control > SSH Server",
            "severity": "CRITICAL",
            "rationale": "SSH Protocol 1 are vulnerabilitati cunoscute si nu ar trebui folosit.",
            "automatedChecks": [
                {
                    "checkId": "5.2.2.1",
                    "title": "Verifica SSH Protocol",
                    "command": "sshd -T 2>/dev/null | grep -i 'protocol' || echo 'PROTOCOL_NOT_SET'",
                    "expectedResult": "protocol 2",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "5.2.3",
            "title": "Verifica SSH LogLevel",
            "category": "Access Control > SSH Server",
            "severity": "MEDIUM",
            "rationale": "Logging verbose ajuta la detectarea tentativelor de acces.",
            "automatedChecks": [
                {
                    "checkId": "5.2.3.1",
                    "title": "Verifica SSH LogLevel",
                    "command": "sshd -T 2>/dev/null | grep -i 'loglevel'",
                    "expectedResult": "loglevel INFO",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "5.2.4",
            "title": "Verifica SSH PermitRootLogin",
            "category": "Access Control > SSH Server",
            "severity": "CRITICAL",
            "rationale": "Login direct ca root prin SSH creste riscul de compromitere.",
            "automatedChecks": [
                {
                    "checkId": "5.2.4.1",
                    "title": "Verifica PermitRootLogin",
                    "command": "sshd -T 2>/dev/null | grep -i 'permitrootlogin'",
                    "expectedResult": "permitrootlogin no",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "5.2.5",
            "title": "Verifica SSH MaxAuthTries",
            "category": "Access Control > SSH Server",
            "severity": "MEDIUM",
            "rationale": "Limitarea incercarilor de autentificare reduce atacurile brute-force.",
            "automatedChecks": [
                {
                    "checkId": "5.2.5.1",
                    "title": "Verifica MaxAuthTries",
                    "command": "sshd -T 2>/dev/null | grep -i 'maxauthtries'",
                    "expectedResult": "maxauthtries 4",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "5.2.6",
            "title": "Verifica SSH PermitEmptyPasswords",
            "category": "Access Control > SSH Server",
            "severity": "CRITICAL",
            "rationale": "Parolele goale sunt un risc major de securitate.",
            "automatedChecks": [
                {
                    "checkId": "5.2.6.1",
                    "title": "Verifica PermitEmptyPasswords",
                    "command": "sshd -T 2>/dev/null | grep -i 'permitemptypasswords'",
                    "expectedResult": "permitemptypasswords no",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "5.3.1",
            "title": "Verifica politica parole - lungime minima",
            "category": "Access Control > Password Policies",
            "severity": "HIGH",
            "rationale": "Parolele scurte sunt vulnerabile la atacuri brute-force.",
            "automatedChecks": [
                {
                    "checkId": "5.3.1.1",
                    "title": "Verifica minlen in pwquality",
                    "command": "grep -E '^minlen' /etc/security/pwquality.conf 2>/dev/null || echo 'NOT_SET'",
                    "expectedResult": "minlen = 14",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "5.4.1",
            "title": "Verifica expirare parole",
            "category": "Access Control > User Accounts",
            "severity": "MEDIUM",
            "rationale": "Parolele trebuie schimbate periodic pentru a limita impactul compromiterii.",
            "automatedChecks": [
                {
                    "checkId": "5.4.1.1",
                    "title": "Verifica PASS_MAX_DAYS",
                    "command": "grep -E '^PASS_MAX_DAYS' /etc/login.defs 2>/dev/null",
                    "expectedResult": "PASS_MAX_DAYS 365",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "5.4.2",
            "title": "Verifica conturi sistem cu shell restrictionat",
            "category": "Access Control > User Accounts",
            "severity": "MEDIUM",
            "rationale": "Conturile de sistem nu ar trebui sa aiba shell-uri interactive.",
            "automatedChecks": [
                {
                    "checkId": "5.4.2.1",
                    "title": "Verifica shell-uri conturi sistem",
                    "command": "awk -F: '($1!=\"root\" && $3<1000 && $7!=\"/usr/sbin/nologin\" && $7!=\"/bin/false\") {print $1}' /etc/passwd 2>/dev/null | head -5 || echo 'OK'",
                    "expectedResult": "OK",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "5.5.1",
            "title": "Verifica root group gol",
            "category": "Access Control > Root Account",
            "severity": "HIGH",
            "rationale": "Nimeni in afara de root nu ar trebui sa fie membru al grupului root.",
            "automatedChecks": [
                {
                    "checkId": "5.5.1.1",
                    "title": "Verifica membrii grupului root",
                    "command": "grep -E '^root:' /etc/group 2>/dev/null | cut -d: -f4",
                    "expectedResult": "",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "6.1.1",
            "title": "Verifica permisiuni /etc/passwd",
            "category": "System Maintenance > System File Permissions",
            "severity": "HIGH",
            "rationale": "Fisierul passwd trebuie sa fie readable dar nu writable de utilizatori.",
            "automatedChecks": [
                {
                    "checkId": "6.1.1.1",
                    "title": "Verifica permisiuni /etc/passwd",
                    "command": "stat -c '%a' /etc/passwd 2>/dev/null",
                    "expectedResult": "644",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "6.1.2",
            "title": "Verifica permisiuni /etc/shadow",
            "category": "System Maintenance > System File Permissions",
            "severity": "CRITICAL",
            "rationale": "Fisierul shadow contine hash-uri de parole si trebuie strict protejat.",
            "automatedChecks": [
                {
                    "checkId": "6.1.2.1",
                    "title": "Verifica permisiuni /etc/shadow",
                    "command": "stat -c '%a' /etc/shadow 2>/dev/null",
                    "expectedResult": "640",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "6.2.1",
            "title": "Verifica absenta fisierelor world-writable",
            "category": "System Maintenance > User and Group Settings",
            "severity": "MEDIUM",
            "rationale": "Fisierele world-writable pot fi modificate de oricine.",
            "automatedChecks": [
                {
                    "checkId": "6.2.1.1",
                    "title": "Cauta fisiere world-writable",
                    "command": "find / -xdev -type f -perm -0002 2>/dev/null | head -5 | wc -l",
                    "expectedResult": "0",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "6.2.2",
            "title": "Verifica absenta fisierelor fara owner",
            "category": "System Maintenance > User and Group Settings",
            "severity": "MEDIUM",
            "rationale": "Fisierele fara owner pot indica probleme sau compromitere.",
            "automatedChecks": [
                {
                    "checkId": "6.2.2.1",
                    "title": "Cauta fisiere fara owner",
                    "command": "find / -xdev \\( -nouser -o -nogroup \\) 2>/dev/null | head -5 | wc -l",
                    "expectedResult": "0",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        }
    ]
}