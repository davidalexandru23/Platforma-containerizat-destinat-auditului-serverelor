{
    "$schema": "bittrail-template@1.0",
    "metadata": {
        "name": "NIS2 Baseline - Linux Server Automated Audit Pack",
        "description": "Template de audit inspirat de cerintele NIS2 (masuri de management al riscurilor si securitate), adaptat pentru servere Linux. Include controale tehnice si operationale, cu verificari automate prin agent acolo unde este posibil.",
        "version": "1.1.1",
        "type": "NIS2",
        "author": "BitTrail Platform",
        "createdAt": "2026-01-27T00:00:00Z"
    },
    "controls": [
        {
            "controlId": "NIS2-1.1",
            "title": "Inventar software si pachete instalate",
            "category": "Asset Management",
            "rationale": "Exista un inventar al software-ului instalat, util pentru evaluarea expunerii si a patching-ului.",
            "severity": "MEDIUM",
            "automatedChecks": [
                {
                    "checkId": "NIS2-1.1.a",
                    "title": "Listare pachete (dpkg/rpm)",
                    "command": "if command -v dpkg >/dev/null 2>&1; then echo 'PKG_MANAGER=dpkg'; dpkg -l | tail -n +6 | wc -l | sed 's/^/PACKAGE_COUNT=/'; elif command -v rpm >/dev/null 2>&1; then echo 'PKG_MANAGER=rpm'; rpm -qa | wc -l | sed 's/^/PACKAGE_COUNT=/'; else echo 'NO_PKG_MGR'; fi",
                    "expectedResult": "PKG_MANAGER=",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": [
                {
                    "checkId": "NIS2-1.1.M1",
                    "title": "Verificare inventar pachete",
                    "instructions": "Verificati lista pachetelor exportata si stocata la fiecare audit si istoricul comparativ intre rulari.",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": true,
                        "allowAttestation": true,
                        "requiresApproval": false
                    }
                }
            ]
        },
        {
            "controlId": "NIS2-1.2",
            "title": "Inventar servicii active si expunere porturi",
            "category": "Asset Management",
            "rationale": "Serviciile care ruleaza si porturile ascultate sunt cunoscute si revizuite periodic.",
            "severity": "HIGH",
            "automatedChecks": [
                {
                    "checkId": "NIS2-1.2.a",
                    "title": "Systemd services running",
                    "command": "if command -v systemctl >/dev/null 2>&1; then systemctl list-units --type=service --state=running --no-pager | head -n 100; else service --status-all 2>/dev/null; fi",
                    "expectedResult": "running",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "NIS2-1.2.b",
                    "title": "Listening ports",
                    "command": "ss -lntup 2>/dev/null || netstat -lntup 2>/dev/null",
                    "expectedResult": "LISTEN",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "NIS2-2.1",
            "title": "Patching si actualizari de securitate aplicate la timp",
            "category": "Vulnerability & Patch Management",
            "rationale": "Sistemul este la zi cu update-uri de securitate, iar restantele sunt tratate printr-un proces clar.",
            "severity": "CRITICAL",
            "automatedChecks": [
                {
                    "checkId": "NIS2-2.1.a",
                    "title": "Check pending security updates",
                    "command": "if command -v apt >/dev/null 2>&1; then UPGRADABLE=$(apt list --upgradable 2>/dev/null | grep -c -v '^Listing'); echo \"PENDING_UPDATES=$UPGRADABLE\"; if [ \"$UPGRADABLE\" -le 20 ]; then echo 'STATUS=OK'; else echo 'STATUS=HIGH_PENDING'; fi; elif command -v dnf >/dev/null 2>&1; then COUNT=$(dnf -q check-update 2>/dev/null | grep -c '.'); echo \"PENDING_UPDATES=$COUNT\"; if [ \"$COUNT\" -le 20 ]; then echo 'STATUS=OK'; else echo 'STATUS=HIGH_PENDING'; fi; else echo 'SKIP_PKG_MGR'; echo 'STATUS=OK'; fi",
                    "expectedResult": "STATUS=OK",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "NIS2-2.2",
            "title": "Vulnerability scanning de baza pe pachete si CVE-uri",
            "category": "Vulnerability & Patch Management",
            "rationale": "Exista o metoda de a corela pachetele instalate cu vulnerabilitati cunoscute (ex: scanner extern sau feed intern).",
            "severity": "HIGH",
            "automatedChecks": [
                {
                    "checkId": "NIS2-2.2.a",
                    "title": "Get OS release",
                    "command": "cat /etc/os-release 2>/dev/null",
                    "expectedResult": "ID=",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "NIS2-2.2.b",
                    "title": "Get Kernel version",
                    "command": "uname -r",
                    "expectedResult": ".",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "NIS2-3.1",
            "title": "Firewall activ si reguli minime pentru expunere",
            "category": "Network Security",
            "rationale": "Exista filtrare la nivel host, cu reguli care permit doar ce este necesar.",
            "severity": "CRITICAL",
            "automatedChecks": [
                {
                    "checkId": "NIS2-3.1.a",
                    "title": "Firewall activ (ufw/nft/iptables)",
                    "command": "if command -v ufw >/dev/null 2>&1; then STATUS=$(ufw status 2>/dev/null | head -1); echo \"$STATUS\"; if echo \"$STATUS\" | grep -qi 'active'; then echo 'FIREWALL=ACTIVE'; else echo 'FIREWALL=INACTIVE'; fi; elif command -v nft >/dev/null 2>&1; then RULES=$(nft list ruleset 2>/dev/null | wc -l); if [ \"$RULES\" -gt 2 ]; then echo 'FIREWALL=ACTIVE'; else echo 'FIREWALL=INACTIVE'; fi; elif command -v iptables >/dev/null 2>&1; then RULES=$(iptables -S 2>/dev/null | grep -cv '^-P'); if [ \"$RULES\" -gt 0 ]; then echo 'FIREWALL=ACTIVE'; else echo 'FIREWALL=INACTIVE'; fi; else echo 'FIREWALL=NOT_FOUND'; fi",
                    "expectedResult": "FIREWALL=ACTIVE",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "NIS2-3.2",
            "title": "SSH hardening, fara root login, fara parole unde e posibil",
            "category": "Access Control",
            "rationale": "Accesul remote este configurat sigur (PermitRootLogin no, PasswordAuthentication off unde este fezabil, ciphers modern).",
            "severity": "CRITICAL",
            "automatedChecks": [
                {
                    "checkId": "NIS2-3.2.a",
                    "title": "SSH PermitRootLogin",
                    "command": "VALUE=$(sshd -T 2>/dev/null | grep -i 'permitrootlogin' | awk '{print $2}'); if [ -z \"$VALUE\" ]; then VALUE=$(grep -i '^PermitRootLogin' /etc/ssh/sshd_config 2>/dev/null | awk '{print $2}'); fi; echo \"PermitRootLogin=$VALUE\"; if echo \"$VALUE\" | grep -qiE '^(no|prohibit-password)$'; then echo 'CHECK=PASS'; else echo 'CHECK=FAIL'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "NIS2-3.2.b",
                    "title": "SSH Protocol si Ciphers",
                    "command": "sshd -T 2>/dev/null | grep -iE '^(protocol|ciphers|macs|kexalgorithms)' | head -n 10; echo 'CHECK=PASS'",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "NIS2-3.3",
            "title": "Politica parole si blocare cont la brute force",
            "category": "Access Control",
            "rationale": "Sunt configurate politici de parola si protectii la incercari repetate (pam_faillock / faillock / fail2ban).",
            "severity": "HIGH",
            "automatedChecks": [
                {
                    "checkId": "NIS2-3.3.a",
                    "title": "PAM Password Policy",
                    "command": "FOUND=$(grep -rlE 'pam_pwquality|pam_cracklib' /etc/pam.d 2>/dev/null | wc -l); if [ \"$FOUND\" -gt 0 ]; then echo 'PAM_POLICY=CONFIGURED'; grep -rE 'pam_pwquality|pam_cracklib' /etc/pam.d 2>/dev/null | head -n 10; else echo 'PAM_POLICY=MISSING'; fi",
                    "expectedResult": "PAM_POLICY=CONFIGURED",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "NIS2-3.3.b",
                    "title": "Brute Force Protection",
                    "command": "if command -v fail2ban-client >/dev/null 2>&1; then echo 'BRUTEFORCE=fail2ban'; fail2ban-client status 2>/dev/null | head -n 5; elif [ -f /etc/security/faillock.conf ]; then echo 'BRUTEFORCE=faillock'; cat /etc/security/faillock.conf 2>/dev/null | grep -v '^#' | grep -v '^$' | head -n 10; elif grep -q 'pam_faillock' /etc/pam.d/* 2>/dev/null; then echo 'BRUTEFORCE=pam_faillock'; else echo 'BRUTEFORCE=NONE'; fi",
                    "expectedResult": "BRUTEFORCE=",
                    "comparison": "REGEX_MATCH",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "NIS2-4.1",
            "title": "Principiul least privilege pentru sudo si conturi admin",
            "category": "Access Control",
            "rationale": "Doar conturile necesare au sudo, iar configurarile sunt auditate.",
            "severity": "HIGH",
            "automatedChecks": [
                {
                    "checkId": "NIS2-4.1.a",
                    "title": "Sudoers NOPASSWD check",
                    "command": "NOPASSWD=$(grep -rn 'NOPASSWD' /etc/sudoers /etc/sudoers.d 2>/dev/null | grep -v '^#' | wc -l); echo \"NOPASSWD_ENTRIES=$NOPASSWD\"; if [ \"$NOPASSWD\" -eq 0 ]; then echo 'CHECK=PASS'; else echo 'CHECK=WARN'; grep -rn 'NOPASSWD' /etc/sudoers /etc/sudoers.d 2>/dev/null | grep -v '^#'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "NIS2-4.1.b",
                    "title": "Admin groups members",
                    "command": "echo '== sudo group =='; getent group sudo 2>/dev/null || echo 'no sudo group'; echo '== wheel group =='; getent group wheel 2>/dev/null || echo 'no wheel group'; TOTAL=$(getent group sudo wheel 2>/dev/null | cut -d: -f4 | tr ',' '\\n' | sort -u | grep -c '.'); echo \"ADMIN_USERS=$TOTAL\"; if [ \"$TOTAL\" -le 5 ]; then echo 'CHECK=PASS'; else echo 'CHECK=EXCESSIVE'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "NIS2-4.2",
            "title": "Conturi fara utilizare, conturi vechi, si acces chei SSH",
            "category": "Identity Lifecycle",
            "rationale": "Conturile inactive sunt revizuite, iar cheile SSH sunt gestionate (authorized_keys).",
            "severity": "MEDIUM",
            "automatedChecks": [
                {
                    "checkId": "NIS2-4.2.a",
                    "title": "Conturi cu shell interactiv",
                    "command": "INTERACTIVE=$(grep -E '/bin/(bash|sh|zsh|fish)$' /etc/passwd | wc -l); echo \"INTERACTIVE_ACCOUNTS=$INTERACTIVE\"; grep -E '/bin/(bash|sh|zsh|fish)$' /etc/passwd | cut -d: -f1,3,7; if [ \"$INTERACTIVE\" -le 15 ]; then echo 'CHECK=PASS'; else echo 'CHECK=REVIEW'; fi",
                    "expectedResult": "INTERACTIVE_ACCOUNTS=",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "NIS2-4.2.b",
                    "title": "Conturi fara parola",
                    "command": "EMPTY=$(awk -F: '($2 == \"\" || $2 == \"!\") {print $1}' /etc/shadow 2>/dev/null | wc -l); echo \"EMPTY_PASSWORD_ACCOUNTS=$EMPTY\"; if [ \"$EMPTY\" -eq 0 ]; then echo 'CHECK=PASS'; else echo 'CHECK=FAIL'; awk -F: '($2 == \"\" || $2 == \"!\") {print $1}' /etc/shadow 2>/dev/null; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "NIS2-5.1",
            "title": "Logging centralizat sau minim local, cu retentie definita",
            "category": "Logging & Monitoring",
            "rationale": "Logurile sunt colectate, protejate si pastrate conform politicii (minim local cu journald/rsyslog).",
            "severity": "HIGH",
            "automatedChecks": [
                {
                    "checkId": "NIS2-5.1.a",
                    "title": "Journald activ",
                    "command": "if systemctl is-active systemd-journald >/dev/null 2>&1; then echo 'JOURNALD=ACTIVE'; journalctl --disk-usage 2>/dev/null; else echo 'JOURNALD=INACTIVE'; fi",
                    "expectedResult": "JOURNALD=ACTIVE",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "NIS2-5.1.b",
                    "title": "Rsyslog activ",
                    "command": "if systemctl is-active rsyslog >/dev/null 2>&1; then echo 'RSYSLOG=ACTIVE'; else echo 'RSYSLOG=INACTIVE'; fi",
                    "expectedResult": "ACTIVE",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "NIS2-5.1.c",
                    "title": "Logrotate configurat",
                    "command": "if [ -f /etc/logrotate.conf ]; then echo 'LOGROTATE=CONFIGURED'; grep -cE 'rotate|weekly|daily' /etc/logrotate.conf 2>/dev/null | sed 's/^/RULES=/'; else echo 'LOGROTATE=MISSING'; fi",
                    "expectedResult": "LOGROTATE=CONFIGURED",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "NIS2-5.2",
            "title": "Auditd activ pentru evenimente sensibile",
            "category": "Logging & Monitoring",
            "rationale": "Audit framework este activ (auditd) sau exista o alternativa echivalenta, pentru trasabilitate.",
            "severity": "MEDIUM",
            "automatedChecks": [
                {
                    "checkId": "NIS2-5.2.a",
                    "title": "Auditd Status",
                    "command": "if systemctl is-active auditd >/dev/null 2>&1; then echo 'AUDITD=ACTIVE'; auditctl -s 2>/dev/null | head -n 5; RULES=$(auditctl -l 2>/dev/null | wc -l); echo \"AUDIT_RULES=$RULES\"; else echo 'AUDITD=INACTIVE'; fi",
                    "expectedResult": "AUDITD=ACTIVE",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "NIS2-6.1",
            "title": "Backup periodic, verificat, si protejat",
            "category": "Backup & Recovery",
            "rationale": "Exista backup-uri regulate, cu test de restore, si separare fata de sistemul auditat.",
            "severity": "CRITICAL",
            "automatedChecks": [
                {
                    "checkId": "NIS2-6.1.a",
                    "title": "Cron jobs configurate",
                    "command": "JOBS=0; for f in /etc/cron.d/* /etc/cron.daily/* /etc/cron.weekly/* /etc/cron.hourly/*; do [ -f \"$f\" ] && JOBS=$((JOBS+1)); done 2>/dev/null; USERJOBS=$(crontab -l 2>/dev/null | grep -cv '^#\\|^$'); JOBS=$((JOBS+USERJOBS)); echo \"CRON_JOBS=$JOBS\"; if [ \"$JOBS\" -gt 0 ]; then echo 'CHECK=PASS'; else echo 'CHECK=FAIL'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "NIS2-6.1.b",
                    "title": "Backup tools presence",
                    "command": "TOOLS=''; command -v restic >/dev/null 2>&1 && TOOLS=\"$TOOLS restic\"; command -v borg >/dev/null 2>&1 && TOOLS=\"$TOOLS borg\"; command -v rclone >/dev/null 2>&1 && TOOLS=\"$TOOLS rclone\"; command -v rsync >/dev/null 2>&1 && TOOLS=\"$TOOLS rsync\"; command -v tar >/dev/null 2>&1 && TOOLS=\"$TOOLS tar\"; if [ -n \"$TOOLS\" ]; then echo \"BACKUP_TOOLS=$TOOLS\"; echo 'CHECK=PASS'; else echo 'BACKUP_TOOLS=NONE'; echo 'CHECK=FAIL'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": [
                {
                    "checkId": "NIS2-6.1.M1",
                    "title": "Verificare politica si teste backup",
                    "instructions": "Incarcati dovada ultimului test de restore si link catre politica de backup.",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": true,
                        "allowAttestation": true
                    }
                }
            ]
        },
        {
            "controlId": "NIS2-6.2",
            "title": "Protectie ransomware de baza la nivel host",
            "category": "Resilience",
            "rationale": "Exista masuri minime: permisiuni corecte, restrictii executie, partitii separate.",
            "severity": "HIGH",
            "automatedChecks": [
                {
                    "checkId": "NIS2-6.2.a",
                    "title": "Partitii separate /tmp /var",
                    "command": "TMP_SEP=$(findmnt /tmp >/dev/null 2>&1 && echo 'YES' || echo 'NO'); VAR_SEP=$(findmnt /var >/dev/null 2>&1 && echo 'YES' || echo 'NO'); echo \"TMP_SEPARATE=$TMP_SEP\"; echo \"VAR_SEPARATE=$VAR_SEP\"; if [ \"$TMP_SEP\" = 'YES' ] || [ \"$VAR_SEP\" = 'YES' ]; then echo 'CHECK=PASS'; else echo 'CHECK=WARN'; fi",
                    "expectedResult": "SEPARATE=",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "NIS2-6.2.b",
                    "title": "World writable dirs",
                    "command": "COUNT=$(find / -xdev -type d -perm -0002 -not -path '/proc/*' -not -path '/sys/*' 2>/dev/null | wc -l); echo \"WORLD_WRITABLE_DIRS=$COUNT\"; if [ \"$COUNT\" -le 5 ]; then echo 'CHECK=PASS'; else echo 'CHECK=WARN'; find / -xdev -type d -perm -0002 -not -path '/proc/*' -not -path '/sys/*' 2>/dev/null | head -n 20; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "NIS2-7.1",
            "title": "Configurare NTP si timp corect",
            "category": "Operations",
            "rationale": "Timpul este sincronizat (chrony/systemd-timesyncd) pentru investigatii si audit.",
            "severity": "MEDIUM",
            "automatedChecks": [
                {
                    "checkId": "NIS2-7.1.a",
                    "title": "Time synchronization status",
                    "command": "if timedatectl status 2>/dev/null | grep -qi 'synchronized: yes\\|NTP.*active'; then echo 'NTP=SYNCED'; timedatectl status 2>/dev/null | head -n 5; elif systemctl is-active chronyd >/dev/null 2>&1; then echo 'NTP=SYNCED'; chronyc tracking 2>/dev/null | head -n 5; elif systemctl is-active systemd-timesyncd >/dev/null 2>&1; then echo 'NTP=SYNCED'; else echo 'NTP=NOT_SYNCED'; fi",
                    "expectedResult": "NTP=SYNCED",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "NIS2-7.2",
            "title": "Criptare in tranzit, configuratii TLS sanatoase",
            "category": "Cryptography",
            "rationale": "Serviciile expuse folosesc TLS modern, fara suite vechi, iar certificatele sunt gestionate.",
            "severity": "HIGH",
            "automatedChecks": [
                {
                    "checkId": "NIS2-7.2.a",
                    "title": "TLS certificates presence",
                    "command": "CERTS=0; [ -d /etc/ssl/certs ] && CERTS=$(ls /etc/ssl/certs/*.pem 2>/dev/null | wc -l); LETSENCRYPT='NO'; [ -d /etc/letsencrypt/live ] && LETSENCRYPT='YES'; echo \"SSL_CERTS=$CERTS\"; echo \"LETSENCRYPT=$LETSENCRYPT\"; if [ \"$CERTS\" -gt 0 ]; then echo 'CHECK=PASS'; else echo 'CHECK=FAIL'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": [
                {
                    "checkId": "NIS2-7.2.M1",
                    "title": "Validare configuratie TLS",
                    "instructions": "Incarcati rezultatul scanarii cu un tool extern (ex: SSL Labs) sau echivalent intern.",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": true,
                        "requiresApproval": false
                    }
                }
            ]
        },
        {
            "controlId": "NIS2-8.1",
            "title": "Protectie la malware, EDR sau alternative",
            "category": "Threat Management",
            "rationale": "Exista o solutie de detectie sau un set minim de masuri (ex: ClamAV, auditd, sysmon for linux, agent EDR).",
            "severity": "MEDIUM",
            "automatedChecks": [
                {
                    "checkId": "NIS2-8.1.a",
                    "title": "Antimalware/EDR Status",
                    "command": "FOUND=''; systemctl is-active clamav-freshclam >/dev/null 2>&1 && FOUND=\"$FOUND clamav\"; systemctl is-active falcon-sensor >/dev/null 2>&1 && FOUND=\"$FOUND crowdstrike\"; systemctl is-active ossec >/dev/null 2>&1 && FOUND=\"$FOUND ossec\"; systemctl is-active wazuh-agent >/dev/null 2>&1 && FOUND=\"$FOUND wazuh\"; command -v clamscan >/dev/null 2>&1 && FOUND=\"$FOUND clamscan\"; command -v rkhunter >/dev/null 2>&1 && FOUND=\"$FOUND rkhunter\"; if [ -n \"$FOUND\" ]; then echo \"MALWARE_PROTECTION=$FOUND\"; echo 'CHECK=PASS'; else echo 'MALWARE_PROTECTION=NONE'; echo 'CHECK=FAIL'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "NIS2-8.2",
            "title": "Integritate fisiere si configuratii critice",
            "category": "Threat Management",
            "rationale": "Se detecteaza modificari neautorizate in fisiere critice (AIDE, audit rules, GitOps, checksums).",
            "severity": "HIGH",
            "automatedChecks": [
                {
                    "checkId": "NIS2-8.2.a",
                    "title": "File Integrity Monitoring",
                    "command": "FOUND=''; command -v aide >/dev/null 2>&1 && FOUND=\"$FOUND aide\"; command -v tripwire >/dev/null 2>&1 && FOUND=\"$FOUND tripwire\"; command -v samhain >/dev/null 2>&1 && FOUND=\"$FOUND samhain\"; [ -f /etc/aide/aide.conf ] && FOUND=\"$FOUND aide-config\"; systemctl is-active auditd >/dev/null 2>&1 && FOUND=\"$FOUND auditd\"; if [ -n \"$FOUND\" ]; then echo \"FIM=$FOUND\"; echo 'CHECK=PASS'; else echo 'FIM=NONE'; echo 'CHECK=FAIL'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "NIS2-9.1",
            "title": "Segregare si minimizare expunere la nivel retea",
            "category": "Network Security",
            "rationale": "Serviciile sunt separate pe retele/zone unde e posibil si nu sunt expuse inutil public.",
            "severity": "HIGH",
            "automatedChecks": [
                {
                    "checkId": "NIS2-9.1.a",
                    "title": "Interfete retea si IP",
                    "command": "ip -br addr 2>/dev/null || ifconfig 2>/dev/null; echo '---'; ip route show default 2>/dev/null",
                    "expectedResult": "UP",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "NIS2-9.1.b",
                    "title": "Docker Exposure",
                    "command": "if command -v docker >/dev/null 2>&1; then EXPOSED=$(docker ps --format '{{.Ports}}' 2>/dev/null | grep -c '0.0.0.0'); echo \"DOCKER_EXPOSED_PORTS=$EXPOSED\"; docker ps --format 'table {{.Names}}\\t{{.Ports}}' 2>/dev/null | head -n 20; if [ \"$EXPOSED\" -le 5 ]; then echo 'CHECK=PASS'; else echo 'CHECK=REVIEW'; fi; else echo 'DOCKER=NOT_INSTALLED'; echo 'CHECK=PASS'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": [
                {
                    "checkId": "NIS2-9.1.M1",
                    "title": "Diagrama de retea si segmentare",
                    "instructions": "Incarcati diagrama de retea, detalii despre VLAN-uri si reguli de perimetru (DMZ).",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": true,
                        "requiresApproval": true
                    }
                }
            ]
        },
        {
            "controlId": "NIS2-9.2",
            "title": "Hardening kernel si sysctl de baza",
            "category": "Secure Configuration",
            "rationale": "Sunt aplicate setari sysctl relevante pentru reducerea riscului (rp_filter, accept_redirects, etc).",
            "severity": "MEDIUM",
            "automatedChecks": [
                {
                    "checkId": "NIS2-9.2.a",
                    "title": "Sysctl hardening keys",
                    "command": "SCORE=0; TOTAL=5; sysctl net.ipv4.ip_forward 2>/dev/null | grep -q '= 0' && SCORE=$((SCORE+1)); sysctl net.ipv4.conf.all.accept_redirects 2>/dev/null | grep -q '= 0' && SCORE=$((SCORE+1)); sysctl net.ipv4.conf.all.rp_filter 2>/dev/null | grep -q '= 1' && SCORE=$((SCORE+1)); sysctl net.ipv4.conf.default.accept_source_route 2>/dev/null | grep -q '= 0' && SCORE=$((SCORE+1)); sysctl kernel.randomize_va_space 2>/dev/null | grep -q '= 2' && SCORE=$((SCORE+1)); echo \"SYSCTL_SCORE=$SCORE/$TOTAL\"; if [ \"$SCORE\" -ge 3 ]; then echo 'CHECK=PASS'; else echo 'CHECK=FAIL'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "NIS2-10.1",
            "title": "Dezactivare servicii inutile",
            "category": "Secure Configuration",
            "rationale": "Serviciile nefolosite sunt dezactivate si pachetele inutile sunt eliminate.",
            "severity": "HIGH",
            "automatedChecks": [
                {
                    "checkId": "NIS2-10.1.a",
                    "title": "Servicii riscante active",
                    "command": "RISKY=''; for s in telnet.socket rsh.socket rlogin.socket vsftpd xinetd avahi-daemon cups; do systemctl is-active \"$s\" >/dev/null 2>&1 && RISKY=\"$RISKY $s\"; done; if [ -z \"$RISKY\" ]; then echo 'RISKY_SERVICES=NONE'; echo 'CHECK=PASS'; else echo \"RISKY_SERVICES=$RISKY\"; echo 'CHECK=FAIL'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "NIS2-11.1",
            "title": "Incident response si colectare dovezi",
            "category": "Incident Management",
            "rationale": "Exista capacitate de a colecta rapid dovezi (procese, conexiuni, loguri), si un flux IR definit.",
            "severity": "HIGH",
            "automatedChecks": [
                {
                    "checkId": "NIS2-11.1.a",
                    "title": "IR tools availability",
                    "command": "TOOLS=''; command -v ps >/dev/null 2>&1 && TOOLS=\"$TOOLS ps\"; command -v ss >/dev/null 2>&1 && TOOLS=\"$TOOLS ss\"; command -v journalctl >/dev/null 2>&1 && TOOLS=\"$TOOLS journalctl\"; command -v tcpdump >/dev/null 2>&1 && TOOLS=\"$TOOLS tcpdump\"; command -v strace >/dev/null 2>&1 && TOOLS=\"$TOOLS strace\"; COUNT=$(echo $TOOLS | wc -w); echo \"IR_TOOLS=$TOOLS\"; echo \"IR_TOOLS_COUNT=$COUNT\"; if [ \"$COUNT\" -ge 3 ]; then echo 'CHECK=PASS'; else echo 'CHECK=FAIL'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": [
                {
                    "checkId": "NIS2-11.1.M1",
                    "title": "Procedura IR",
                    "instructions": "Documentati procedura de Incident Response, rolurile, timpii tinta si canalele de comunicare.",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": true,
                        "requiresApproval": false
                    }
                }
            ]
        },
        {
            "controlId": "NIS2-11.2",
            "title": "Notificare incidente si trasabilitate",
            "category": "Incident Management",
            "rationale": "Exista un mecanism de inregistrare, clasificare si urmarire a incidentelor, inclusiv post-mortem.",
            "severity": "MEDIUM",
            "automatedChecks": [],
            "manualChecks": [
                {
                    "checkId": "NIS2-11.2.M1",
                    "title": "Registru incidente",
                    "instructions": "Furnizati exemple de tichete, timeline incidents, rapoarte post-mortem si politica de raportare.",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": true,
                        "requiresApproval": false
                    }
                }
            ]
        },
        {
            "controlId": "NIS2-12.1",
            "title": "Supply chain si dependinte (SBOM)",
            "category": "Supply Chain Security",
            "rationale": "Sunt cunoscute dependintele (pachete, imagini container), sursele, si exista verificari de baza.",
            "severity": "MEDIUM",
            "automatedChecks": [
                {
                    "checkId": "NIS2-12.1.a",
                    "title": "Docker images inventory",
                    "command": "if command -v docker >/dev/null 2>&1; then IMAGES=$(docker images -q 2>/dev/null | wc -l); echo \"DOCKER_IMAGES=$IMAGES\"; docker images --format '{{.Repository}}:{{.Tag}} {{.Size}}' 2>/dev/null | head -n 20; echo 'CHECK=PASS'; else echo 'DOCKER=NOT_INSTALLED'; echo 'CHECK=PASS'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": [
                {
                    "checkId": "NIS2-12.1.M1",
                    "title": "Registru furnizori",
                    "instructions": "Documentati registrul de furnizori, procesul de selectie si evaluarea riscurilor asociate.",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": true
                    }
                }
            ]
        },
        {
            "controlId": "NIS2-13.1",
            "title": "Separare privilegii pentru aplicatii",
            "category": "Secure Configuration",
            "rationale": "Aplicatiile ruleaza cu user dedicat, fara drepturi excesive, si cu permisiuni corecte pe fisiere.",
            "severity": "HIGH",
            "automatedChecks": [
                {
                    "checkId": "NIS2-13.1.a",
                    "title": "Procese root vs non-root",
                    "command": "ROOT_PROCS=$(ps -eo user | grep -c '^root'); TOTAL_PROCS=$(ps -eo user | wc -l); NON_ROOT=$((TOTAL_PROCS - ROOT_PROCS)); echo \"ROOT_PROCESSES=$ROOT_PROCS\"; echo \"NON_ROOT_PROCESSES=$NON_ROOT\"; echo \"TOTAL=$TOTAL_PROCS\"; echo 'CHECK=PASS'",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "NIS2-13.1.b",
                    "title": "SUID/SGID files",
                    "command": "COUNT=$(find / -xdev \\( -perm -4000 -o -perm -2000 \\) -type f 2>/dev/null | wc -l); echo \"SUID_SGID_FILES=$COUNT\"; if [ \"$COUNT\" -le 30 ]; then echo 'CHECK=PASS'; else echo 'CHECK=REVIEW'; find / -xdev \\( -perm -4000 -o -perm -2000 \\) -type f 2>/dev/null | head -n 30; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "NIS2-14.1",
            "title": "Configurare DNS si rezolvare sigura",
            "category": "Network Security",
            "rationale": "Sunt configurate resolver-e corecte, iar hijacking-ul local este redus (hosts, resolv.conf, systemd-resolved).",
            "severity": "LOW",
            "automatedChecks": [
                {
                    "checkId": "NIS2-14.1.a",
                    "title": "Resolver config",
                    "command": "if [ -f /etc/resolv.conf ]; then echo 'RESOLVER=CONFIGURED'; cat /etc/resolv.conf 2>/dev/null | grep nameserver; echo 'CHECK=PASS'; else echo 'RESOLVER=MISSING'; echo 'CHECK=FAIL'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                },
                {
                    "checkId": "NIS2-14.1.b",
                    "title": "Hosts file content",
                    "command": "ENTRIES=$(grep -cv '^#\\|^$' /etc/hosts 2>/dev/null); echo \"HOSTS_ENTRIES=$ENTRIES\"; cat /etc/hosts 2>/dev/null | head -n 20; if [ \"$ENTRIES\" -le 20 ]; then echo 'CHECK=PASS'; else echo 'CHECK=REVIEW'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "NIS2-15.1",
            "title": "Conformitate configuratie (Drift Detection)",
            "category": "Governance & Assurance",
            "rationale": "Exista o referinta de configuratie (benchmark) si se detecteaza abaterile in timp.",
            "severity": "MEDIUM",
            "automatedChecks": [
                {
                    "checkId": "NIS2-15.1.a",
                    "title": "Config files hashes",
                    "command": "FOUND=0; for f in /etc/ssh/sshd_config /etc/passwd /etc/group /etc/sudoers /etc/sysctl.conf; do if [ -f \"$f\" ]; then FOUND=$((FOUND+1)); echo \"$(sha256sum \"$f\")\"; fi; done 2>/dev/null; echo \"CONFIG_FILES_HASHED=$FOUND\"; if [ \"$FOUND\" -ge 3 ]; then echo 'CHECK=PASS'; else echo 'CHECK=FAIL'; fi",
                    "expectedResult": "CHECK=PASS",
                    "comparison": "CONTAINS",
                    "checkType": "COMMAND"
                }
            ],
            "manualChecks": []
        },
        {
            "controlId": "NIS2-16.1",
            "title": "Managementul riscului, politici si responsabilitati",
            "category": "Governance",
            "rationale": "Exista politici si roluri (cine aproba, cine executa, cine verifica), plus un registru de riscuri.",
            "severity": "MEDIUM",
            "automatedChecks": [],
            "manualChecks": [
                {
                    "checkId": "NIS2-16.1.M1",
                    "title": "Guvernanta si risc",
                    "instructions": "Incarcati politica de securitate, rolurile si registrul de riscuri (inclusiv acceptare risc / plan tratament).",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": true
                    }
                }
            ]
        },
        {
            "controlId": "NIS2-17.1",
            "title": "Business continuity, BCP/DR si teste",
            "category": "Business Continuity",
            "rationale": "Exista plan BCP/DR, RTO/RPO, si teste periodice pentru scenarii critice.",
            "severity": "HIGH",
            "automatedChecks": [],
            "manualChecks": [
                {
                    "checkId": "NIS2-17.1.M1",
                    "title": "BCP/DR Evidence",
                    "instructions": "Incarcati planul BCP/DR, valorile RTO/RPO si raportul ultimului test efectuat.",
                    "evidenceSpec": {
                        "allowUpload": true,
                        "allowLink": true,
                        "requiresApproval": true
                    }
                }
            ]
        }
    ]
}